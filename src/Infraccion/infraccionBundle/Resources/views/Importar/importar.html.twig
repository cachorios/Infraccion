{% extends '::layout.html.twig' %}
{% block id 'mod_importar' %}

    {% block title %}
        {{ parent() }} - Importacion
    {% endblock %}

    {% block page %}

        <section id="view_importar">
            {% embed 'box.html.twig' with {'box_titulo': 'Importar Infracciones' } %}
                {% block box_contenido %}
                    <div class="row-fluid">
                        <div class="span12" style="margin-top: 0;">
                            {{ wo_render_breadcrumbs() }}

                            {% for type, flashMessages in app.session.flashbag.all() %}
                                {% for flashMessage in flashMessages %}
                                    <div class='alert alert-{{ type }}'>
                                        {{ flashMessage|trans({}, 'JordiLlonchCrudGeneratorBundle') }}
                                    </div>
                                {% endfor %}
                            {% endfor %}
                        </div>
                    </div>


                    <div class="row-fluid" style="margin-top: 0;">
                        <div class="span12" style="zoom: 1; overflow: auto; margin-top: -8px;">
                            <table class="table table-striped table-bordered table-condensed">
                                <thead>
                                <tr>
                                    <th>Empresa</th>
                                    <th>Ubicación</th>
                                    <th>Infracción</th>
                                    <th>Fecha</th>
                                    <th>Carpeta</th>
                                    <th>Accion</th>
                                </tr>
                                </thead>
                                <tbody>
                                    {% for fila in reg %}
                                    <tr>
                                        <td>
                                            {{ fila[1] }}
                                        </td>
                                        <td>
                                            {{ fila[3] }}
                                        </td>
                                        <td>
                                            {{ fila[5] }}
                                        </td>
                                        <td>
                                            {{ fila[6] }}
                                        </td>
                                        <td>
                                            {{ fila[7] }}
                                        </td>
                                        <td>
                                            <button class="brn_importar" data-dir="{{  fila[7] }}" class="btn btn-primary" >Importar</button>

                                            <img id="{{ fila[7] }}" src="{{ asset("img/"~ 'pbar.gif') }}" style="height: 20px; display: none" >
                                            {#<a href="{{ path("infraccion_importar_carpeta",{'carpeta': fila[7]}) }}" class="btn btn-primary">Importar</a>#}
                                        </td>

                                    </tr>
                                    {% endfor %}
                                </tbody>

                            </table>
                        </div>
                    </div>

                {% endblock box_contenido %}
            {% endembed %}
        </section>
        <script>
        $(document).ready(function(){
            $(".brn_importar").click(function(){
                sdir = $(this).data("dir");

                $.blockUI({ message: '<h1   > <img src="{{ asset("img/indicator.gif") }}" style="padding-right: 20px;"  /> Importando, espere...</h1>' });
                $("#"+sdir).show();
                $.ajax({
                    type: "POST",
                    url: '{{ path("infraccion_importar_carpeta") }}',
                    data: {'carpeta': sdir},
                    success: function(data){
                        //$("#"+sdir).hide();
                        //$.unblockUI();
                        if(data.length >0)
                            alert(data);

                        $(location).attr("href","{{ path("importar_infraccion") }}");

                    },
                    dataType: 'html'
                });



            });
        });
        </script>
    {% endblock %}

